<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Truckville | OCC Dispatch Portal</title>
  <link rel="icon" href="assets/favicon.ico" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <!-- TOASTS -->
  <div class="toast-wrap" id="toasts"></div>

  <!-- HEADER / NAV -->
  <header class="header">
    <div class="left">
      <img class="logo" src="assets/favicon.ico" alt="OCC" width="500" height="600">
      <nav class="nav" id="navTabs">
        <button class="tab active" data-page="dashboard">Dashboard</button>
        <button class="tab" data-page="bolos">BOLOs</button>
        <button class="tab" data-page="about">About</button>
      </nav>
      <button class="btn ghost" id="btnChangelog">What's New</button>
    </div>
    <div class="right">
      <div class="clock" id="clock">0000-00-00 00:00:00Z</div>
      <span class="chip"><input type="checkbox" id="toggleZulu" checked> Zulu</span>
      <button class="btn ghost" id="btnExport">Export</button>
      <button class="btn ghost" id="btnImport">Import</button>
      <input id="importFile" type="file" accept="application/json" class="hidden" />
      <button class="btn ghost" id="btnSettings">Settings</button>
      <button class="btn danger" id="btnReset">Reset</button>
      <a class="btn brand" id="btnDiscord" href="https://discord.gg/truckville" target="_blank">Discord</a>
    </div>
  </header>

  <!-- PAGES -->
  <main id="pages">
    <!-- DASHBOARD PAGE -->
    <section data-page="dashboard" class="layout dashboard" id="dashboard-page">
      <!-- LEFT: CALLS LIST -->
      <aside class="card">
        <h3>
          Calls Board
          <span class="toolbar">
            <button class="btn" id="btnNewCall"><span>+ Call</span><kbd>N</kbd></button>
            <select id="filterPriority">
              <option value="">Priority: All</option>
              <option value="1">Priority 1</option>
              <option value="2">Priority 2</option>
              <option value="3">Priority 3</option>
            </select>
          </span>
        </h3>
        <div class="inline" style="margin-bottom:8px">
          <input id="searchCalls" placeholder="Search title/location…" />
          <button class="btn ghost" id="btnCloseCall" title="Close selected call"><span>Delete Selected Call</span><kbd>Del</kbd></button>
        </div>
        <div class="list" id="callsList"></div>
      </aside>

      <!-- CENTER: CALL EDITOR + LOG -->
      <section class="card">
        <h3>
          <span id="editorTitle">New Dispatch</span>
          <span class="toolbar">
            <button class="btn brand" id="btnCreateCall"><b>Create</b> <kbd>Ctrl</kbd><kbd>Enter</kbd></button>
            <button class="btn warn hidden" id="btnUpdateCall"><b>Update</b> <kbd>S</kbd></button>
            <button class="btn ghost" id="btnClearEditor">Clear</button>
          </span>
        </h3>

        <div class="stack">
          <div class="field"><label>Title</label><input id="fTitle" placeholder="ROBBERY / TRAFFIC STOP / MVA" /></div>
          <div class="field"><label>Location</label><input id="fLocation" placeholder="STREET / NEAREST LAND MARK"/></div>
          <div class="field"><label>Description</label><textarea id="fDesc" placeholder="NOTES / SUSPECT DESC / 10-CODES"></textarea></div>

          <div class="inline">
            <span class="chip">Quick codes:</span>
            <button class="btn ghost" data-insert="10-8 AVAILABLE">10-8</button>
            <button class="btn ghost" data-insert="10-76 ENROUTE">10-76</button>
            <button class="btn ghost" data-insert="10-23 ON SCENE">10-23</button>
            <button class="btn ghost" data-insert="CODE 3 (LIGHTS/SIREN)">C3</button>
            <button class="btn ghost" data-insert="SCENE SAFE">SAFE</button>
          </div>

          <div class="inline">
            <div class="field" style="flex:1"><label>Priority</label>
              <select id="fPriority">
                <option value="" disabled selected>Select…</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
              </select>
            </div>
            <div class="field" style="flex:2"><label>Attach Selected Units</label>
              <button class="btn ok" id="btnAttach">Attach</button>
              <button class="btn ghost" id="btnDetach">Detach</button>
              <span class="muted" id="attachedCount">0 attached</span>
            </div>
          </div>

          <div class="divider"></div>
          <h3 style="margin-top:0">Incident Log</h3>
          <div class="log" id="incidentLog"></div>
        </div>
      </section>

      <!-- UNITS: FULL WIDTH UNDER CALLS/EDITOR -->
      <aside class="card unitsWrap">
        <h3>
          Active Units
          <span class="toolbar">
            <button class="btn" id="btnAddUnit">+ Unit <kbd>U</kbd></button>
            <select id="filterDept">
              <option value="">DEPT: ALL</option>
              <option value="FVMPD">FVMPD</option>
              <option value="NPS">NPS</option>
              <option value="OUSO">OUSO</option>
              <option value="WSP">WSP</option>
              <option value="GVFD">GVFD</option>
              <option value="WISDOT">WISDOT</option>
            </select>

            <select id="filterStatus">
              <option value="">STATUS: ALL</option>
              <option value="AVAILABLE">AVAILABLE</option>
              <option value="ENROUTE">ENROUTE</option>
              <option value="ONSCENE">ONSCENE</option>
              <option value="BUSY">BUSY</option>
              <option value="UNAVAILABLE">UNAVAILABLE</option>
              <option value="PRIORITY">PRIORITY</option>
            </select>

          </span>
        </h3>
        <div id="unitLog">
          <table class="unitsTable">
            <thead>
              <tr><th style="width:0px"></th><th style="width:200px">Unit</th><th>Name</th><th>Dept</th><th>Status</th><th>For</th><th>Quick Action</th></tr>
            </thead>
            <tbody id="unitsTBody"></tbody>
          </table>
        </div>
        <div class="muted" id="noUnits" style="text-align:center; padding:8px;">No active units</div>
      </aside>
    </section>

    <!-- BOLOs PAGE (editor + list) -->
    <section data-page="bolos" class="layout hidden" id="bolos-page">
      <section class="card">
        <h3>
          <span id="boloEditorTitle">New BOLO</span>
          <span class="toolbar">
            <button class="btn brand" id="btnCreateBolo"><b>Create</b></button>
            <button class="btn warn hidden" id="btnUpdateBolo"><b>Update</b></button>
            <button class="btn ghost" id="btnClearBolo">Clear</button>
          </span>
        </h3>
        <div class="stack">
          <div class="field"><label>Type</label>
            <select id="bType">
              <option value="" disabled selected>Select…</option>
              <option>VEHICLE</option>
              <option>PERSON</option>
              <option>OTHER</option>
            </select>
          </div>
          <div class="field"><label>Summary</label><input id="bSummary" placeholder="BLACK SEDAN / PLATE WI. 4XK928"/></div>
          <div class="field"><label>Last Seen</label><input id="bLastSeen" placeholder="NB TWIST RD"/></div>
          <div class="field"><label>Notes</label><textarea id="bNotes" placeholder="DISTINGUISHING FEATURES / ASSOCIATES"></textarea></div>
        </div>
      </section>
      <section class="card" style="grid-column: span 2;">
        <h3>BOLO List</h3>
        <div class="list" id="boloList"></div>
      </section>
    </section>

    <!-- ABOUT PAGE -->
    <section class="card about layout hidden" data-page="about">
      <header class="about__hero">
        <div class="about__pretitle">About</div>
        <h2 class="about__title">Truckville OCC Dispatch Manager</h2>
        <p class="about__lead">
          A free, volunteer-built tool to streamline RP dispatch and improve session flow for OCC Telecommunicators on Roblox.
          Built for speed, clarity, and reliability—no external APIs required.
        </p>

        <div class="about__cta">
          <a class="btn about__btn" href="https://discord.gg/truckville" target="_blank" rel="noopener">Join Discord</a>
          <a class="btn about__btn" href="https://github.com/AfterrFluff/truckville-dispatch-manager" target="_blank" rel="noopener">View on GitHub</a>
        </div>
      </header>

      <div class="about__grid">
        <section class="about__section">
          <h3 class="about__h3">Highlights</h3>
          <ul class="about__chips">
            <li class="chip">Manual-first, RP friendly</li>
            <li class="chip">Smart call editor</li>
            <li class="chip">Enhanced dropdowns</li>
            <li class="chip">Attach/Detach flow</li>
            <li class="chip">Per-call incident log</li>
            <li class="chip">BOLO manager</li>
            <li class="chip">Local save / import / export</li>
            <li class="chip">Keyboard shortcuts</li>
          </ul>
        </section>

        <section class="about__section">
          <h3 class="about__h3">How it works</h3>
          <ol class="timeline">
            <li><b>Create a call</b> — title, location, priority, notes.</li>
            <li><b>Add units</b> — department &amp; status with color coding.</li>
            <li><b>Attach units</b> — quick actions for A/E/S.</li>
            <li><b>Track</b> — per-call incident log with timestamps.</li>
            <li><b>Manage BOLOs</b> — quick inputs, always visible counts.</li>
            <li><b>Save/Share</b> — export JSON to reuse next session.</li>
          </ol>
        </section>

        <section class="about__section">
          <h3 class="about__h3">Privacy Policy</h3>

          <div class="policy">
            <h4>1. Information We Collect</h4>
            <p>
              We don’t collect personal data on any server. The app stores your session
              data locally in your browser (calls, units, BOLOs, and preferences) to make your experience fast and offline-friendly.
            </p>
          </div>

          <div class="policy">
            <h4>2. Data Security</h4>
            <p>
              Because data stays on your device, exposure risk is reduced. For best results,
              use trusted devices and keep your browser up to date.
            </p>
          </div>

          <div class="policy">
            <h4>3. Policy Updates</h4>
            <p>
              We may revise this policy to reflect improvements or legal requirements. Changes will be posted here—check back occasionally.
            </p>
          </div>
        </section>

        <section class="about__section">
          <h3 class="about__h3">FAQ</h3>
          <details class="faq">
            <summary>Why manual entry instead of live game data?</summary>
            <p>Roblox games don’t expose a public API for this use. Manual fields keep it universal and flexible for RP.</p>
          </details>
          <details class="faq">
            <summary>Does it work offline?</summary>
            <p>Yes. Everything runs in your browser and persists with LocalStorage. You can also export/import JSON.</p>
          </details>
          <details class="faq">
            <summary>Can I request features?</summary>
            <p>Absolutely—open an issue on GitHub or ping us on Discord.</p>
          </details>
        </section>
      </div>

      <footer class="about__foot">
        <div class="about__small">

        </div>
      </footer>
    </section>

  </main>

  <!-- GLOBAL COUNTS FOOTER (visible everywhere) -->
  <footer class="footer" id="globalFooter">
    <div class="stat"><b id="statUnits">0</b> units</div>
    <div class="stat"><b id="statCalls">0</b> calls</div>
    <div class="stat"><b id="statBolos">0</b> bolos</div>
    <span class="chip" id="verChip">v0.9.1</span>
    <span class="chip" id="schemaChip">schema v1</span>
  </footer>

  <!-- SETTINGS MODAL -->
  <dialog id="dlgSettings">
    <form method="dialog" style="display:flex; flex-direction:column; gap:10px;">
      <h3>Settings</h3>
      <label class="inline"><input type="checkbox" id="sInstantDelete"/> Instant delete (skip confirm)</label>
      <label class="inline"><input type="checkbox" id="sDisableNotifs"/> Disable notifications</label>
      <label class="inline"><input type="checkbox" id="sSimpleZulu" checked/> Simple Zulu (ISO)</label>
      <label class="inline"><input type="checkbox" id="sAutoStatus" checked/> Auto status flow (Attach→ENROUTE, Detach→AVAILABLE)</label>
      <label class="inline"><input type="checkbox" id="sDefaultAvail"/> New units default AVAILABLE</label>
      <menu class="inline" style="justify-content:flex-end; margin-top:6px;">
        <button class="btn ghost" value="cancel">Close</button>
        <button class="btn ok" value="default" id="btnSaveSettings">Save</button>
      </menu>
    </form>
  </dialog>

  <!-- Changelog (classic style) -->
  <dialog id="dlgChangelog" class="clg">
    <div class="clg__topbar">
      <div>
        <span id="changelogVer">0.0.0</span> is now live
      </div>
      <button class="clg__close" aria-label="Close" onclick="document.getElementById('dlgChangelog').close()">✖</button>
    </div>

    <div class="clg__content">
      <h3>Major revamp update, redesign, features & more!</h3>
      <p>
        With this update, we've introduced a lot of new intuitive interface designs, functionality and bug fixes.
      </p>
      <ul>
        <li>Revamped the platform fully!</li>
        <li>Working BOLOs!</li>
        <li>Various keybinds to do actions quickly!</li>
        <li>Various settings based on your liking!</li>
        <li>Import & Export your Dispatch Data!</li>
        <li>New call incident log tracking system!</li>
        <li>Quick status actions!</li>
        <li>Seamlessly select multiple units to add to calls!</li>
        <li>And so much more behind-the-scenes changes!</li>
      </ul>
    </div>
  </dialog>


  <script src="app.js"></script>
</body>
</html>
